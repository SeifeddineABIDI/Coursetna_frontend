
<div class="modal dark:hover:bg-hover" [ngClass]="{'hidden': !showModala}"
    style="box-shadow: -2px 0px 8px rgba(0,0,0,0.1); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
    </div>
    <div class="modal-content dark:bg-hover bg-white"

        style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; width: 80%; max-width: 800px; z-index: 10000;">
        <h2 style="margin-bottom: 20px; text-align: center;">Create a Discussion</h2>
        <div style="display: flex; flex-direction: row;">

            <div style="flex: 1; margin-right: 20px; overflow-y: auto; max-height: 500px; max-width: 300px;">

                <!-- app.component.html -->
                <div *ngFor="let user of users">
                    <div *ngIf="user.id != currentUserId">
                        <div (click)="toggleUserSelection(user)" [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                            style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">

                            <div style="display: flex; align-items: center;">
                                <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                                    style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                                    alt="{{user.prenom}} {{user.nom}}">
                                <span>{{ user.prenom }} {{ user.nom }}</span>
                            </div>
                        </div>
                    </div>
                </div>




            </div>
            <div style="flex: 1;">
                <h3 style="margin: 0;"><- Search for students</h3>

                        <div style="display: flex; gap: 10px; align-items: center;">
                            <!-- First Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="prenomInput" placeholder="First name" />
                            </mat-form-field>

                            <!-- Second Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="nomInput" placeholder="Last name" />
                            </mat-form-field>

                            <!-- Search Button -->
                            <button (click)="retrieveUsersForDiscussion()" mat-stroked-button>
                                üîç
                            </button>
                        </div>

                        <h3 style="margin: 0;">"Group" discussion title:</h3>
                        <mat-form-field class="fuse-mat-bold w-full" style="margin-bottom: 20px;">
                            <input type="text" matInput [(ngModel)]="inputTitle"
                                placeholder="Insert discussion title here">
                        </mat-form-field>
                        <h3 style="margin: 0;">Insert image for "Group" discussion:</h3>
                        <input type="file" (change)="handleFileInput($event)" style="margin-bottom: 10px;">
                        <div *ngIf="imageData != ' ' else fallback">
                            <img [src]="imageData" alt="Uploaded Image"
                                style="width: 70px; height: 70px; border-radius: 50%;">
                        </div>
                        <ng-template #fallback>
                            <img [src]="'https://i.pinimg.com/originals/71/c7/53/71c7533cc831bf2d6ddffdd74cd117bb.png'"
                                alt="Default Image" style="width: 70px; height: 70px; border-radius: 50%;">
                        </ng-template>

            </div>
        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end;">

            <button class="bg-primary-400" (click)="startDiscussion()" mat-raised-button
                style="border-radius: 8%; border: 4px; padding: 10px 20px; margin-right: 10px;">Confirm</button>
            <button class="bg-gray-200" (click)="closeModala()" mat-raised-button
                style="border-radius: 8%; border: 4px; padding: 10px 20px;">Close</button>
        </div>
    </div>
</div>


<div class="modal" [ngClass]="{'hidden': !showModalc}"
    style="box-shadow: -2px 0px 8px rgba(0,0,0,0.1); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
    </div>
    <div class="modal-content dark:bg-hover bg-white"
        style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; width: 80%; max-width: 800px; z-index: 10000;">
        <h2 style="margin-bottom: 20px; text-align: center;">Modify a Discussion</h2>
        <div style="display: flex; flex-direction: row;">
            <!-- Duplicate this section to create three columns -->
            <div style="flex: 1; margin-right: 20px; overflow-y: auto; max-height: 500px;">
                <h3 style="margin: 0;">Existing students:</h3>

                <div *ngFor="let user of existingUsers">
                    <div *ngIf="user.id != currentUserId">
                        <div (click)="toggleUserSelection(user)" [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                            style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">

                            <div style="display: flex; align-items: center;">
                                <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                                    style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                                    alt="{{user.prenom}} {{user.nom}}">
                                <span>{{ user.prenom }} {{ user.nom }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="flex: 1; margin-right: 20px; overflow-y: auto; max-height: 500px;">

                <div *ngFor="let user of users">
                    <div *ngIf="user.id != currentUserId && !ifUserinDiscussion(user.id)">
                        <div (click)="toggleUserSelection(user)" [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                            style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">

                            <div style="display: flex; align-items: center;">
                                <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                                    style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                                    alt="{{user.prenom}} {{user.nom}}">
                                <span>{{ user.prenom }} {{ user.nom }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- The second part of the modal -->
            <div style="flex: 1;">
                <h3 style="margin: 0;"><- Search for students</h3>

                        <div style="display: flex; gap: 10px; align-items: center;">
                            <!-- First Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="prenomInput" placeholder="First name" />
                            </mat-form-field>

                            <!-- Second Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="nomInput" placeholder="Last name" />
                            </mat-form-field>

                            <!-- Search Button -->
                            <button (click)="retrieveUsersForDiscussion()" mat-stroked-button>
                                üîç
                            </button>
                        </div>


                        <h3 style="margin: 0;">Group discussion title:</h3>
                        <mat-form-field class="fuse-mat-bold w-full" style="margin-bottom: 20px;">
                            <input type="text" matInput [(ngModel)]="inputTitle"
                                placeholder="Insert discussion title here">
                        </mat-form-field>

                        <h3 style="margin: 0;">Insert image for "Group" discussion:</h3>
                        <input type="file" (change)="handleFileInput($event)" style="margin-bottom: 10px;">
                        <div *ngIf="imageDatam != ' ' else fallback">
                            <img [src]="imageDatam" alt="Uploaded Image"
                                style="width: 70px; height: 70px; border-radius: 50%;">
                        </div>

                        <ng-template #fallback>
                            <img [src]="'https://i.pinimg.com/originals/71/c7/53/71c7533cc831bf2d6ddffdd74cd117bb.png'"
                                alt="Default Image" style="width: 70px; height: 70%; border-radius: 50%;">
                        </ng-template>
            </div>
        </div>

        <div class="modal-footer" style="display: flex; justify-content: flex-end;">

            <button class="bg-primary-400" mat-raised-button (click)="modifyDiscussion()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px; margin-right: 10px;">Confirm</button>
            <button class="bg-gray-200" mat-raised-button (click)="closeModalc()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px;">Close</button>
        </div>
    </div>
</div>



<div class="modal" [ngClass]="{'hidden': !showModalb}"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
    </div>
    <div class="modal-content dark:bg-hover bg-white"
        style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; width: 80%; max-width: 800px; z-index: 10000;">
        <h2 style="margin-bottom: 20px; text-align: center;">Create a Community</h2>
        <div style="display: flex; flex-direction: row;">
            <!-- Left side: Discussions -->
            <div style="flex: 1; margin-right: 20px; overflow-y: auto; max-height: 500px;">

                <!-- app.component.html -->

                <div *ngFor="let user of users">
                    <div *ngIf="user.id != currentUserId">
                        <div (click)="toggleUserSelection(user)" [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                            style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">

                            <div style="display: flex; align-items: center;">
                                <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                                    style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                                    alt="{{user.prenom}} {{user.nom}}">
                                <span>{{ user.prenom }} {{ user.nom }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Middle side: Student Search, Group Title, and Image Input -->
            <div style="flex: 1; padding-right: 20px;">
                <h3 style="margin: 0;"><-Search for students</h3>

                        <div style="display: flex; gap: 10px; align-items: center;">
                            <!-- First Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="prenomInput" placeholder="First name" />
                            </mat-form-field>

                            <!-- Second Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="nomInput" placeholder="Last name" />
                            </mat-form-field>

                            <!-- Search Button -->
                            <button (click)="retrieveUsersForDiscussion()" mat-stroked-button>
                                üîç
                            </button>
                        </div>

                        <h3 style="margin: 0;">Community title:</h3>
                        <mat-form-field class="fuse-mat-bold w-full" style="margin-bottom: 20px;">
                            <input type="text" matInput [(ngModel)]="inputTitle"
                                placeholder="Insert community title here">
                        </mat-form-field>
                        <h3 style="margin: 0;">Insert image for Community:</h3>
                        <input type="file" (change)="handleFileInput($event)" style="margin-bottom: 10px;">
                        <div *ngIf="imageData != ' ' else fallback">
                            <img [src]="imageData" alt="Uploaded Image"
                                style="width: 70px; height: 70px; border-radius: 50%;">
                        </div>
                        <ng-template #fallback>
                            <img [src]="'https://i.pinimg.com/originals/71/c7/53/71c7533cc831bf2d6ddffdd74cd117bb.png'"
                                alt="Default Image" style="width: 70px; height: 70px; border-radius: 50%;">
                        </ng-template>
            </div>

            <!-- Right side: Channels with Add/Remove -->
            <div style="flex: 1; overflow-y: auto; max-height: 300px;">
                <h3 style="margin: 0;">Channels:</h3>
                <div *ngFor="let channel of channels; let i=index">
                    <mat-form-field class="fuse-mat-bold w-full">
                        <input type="text" matInput [(ngModel)]="channels[i]" placeholder="Channel {{ i + 1 }}">
                    </mat-form-field>
                </div>
                <div>
                    <button (click)="addChannel()" style="margin-right: 10px;">+</button>
                    <button (click)="removeChannel()" style="margin-right: 10px;">-</button>
                </div>
            </div>
        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end;">

            <button class="bg-primary-400" mat-raised-button (click)="startCommunity()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px; margin-right: 10px;">Confirm</button>
            <button class="bg-gray-200" mat-raised-button (click)="closeModalb()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px;">Close</button>
        </div>
    </div>
</div>


<div class="modal" [ngClass]="{'hidden': !showModald}"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
    </div>
    <div class="modal-content dark:bg-hover bg-white"
        style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; width: 90%; max-width: 1000px; z-index: 10000;">

        <h2 style="margin-bottom: 20px; text-align: center;">Modify a Community</h2>
        <div style="display: flex; flex-direction: row; gap: 20px;">

            <!-- User List 1 -->
            <div style="flex: 1; overflow-y: auto; max-height: 500px;">
                <h3 style="margin: 0;">Existing students:</h3>
                <div *ngFor="let user of existingUsers">
                    <div *ngIf="user.id != currentUserId">
                        <div (click)="toggleUserSelection(user)" [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                            style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">

                            <div style="display: flex; align-items: center;">
                                <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                                    style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                                    alt="{{user.prenom}} {{user.nom}}">
                                <span>{{ user.prenom }} {{ user.nom }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- User List 2 -->
            <div style="flex: 1; overflow-y: auto; max-height: 500px;">
                <div *ngFor="let user of users">
                    <div *ngIf="user.id != currentUserId && !ifUserinDiscussion(user.id)">
                        <div (click)="toggleUserSelection(user)" [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                            style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">

                            <div style="display: flex; align-items: center;">
                                <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                                    style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                                    alt="{{user.prenom}} {{user.nom}}">
                                <span>{{ user.prenom }} {{ user.nom }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Option List -->
            <div style="flex: 1; padding-right: 20px;">
                <h3 style="margin: 0;"><- Search for students</h3>

                        <div style="display: flex; gap: 10px; align-items: center;">
                            <!-- First Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="prenomInput" placeholder="First name" />
                            </mat-form-field>

                            <!-- Second Input Field -->
                            <mat-form-field class="fuse-mat-bold" style="flex-grow: 1;">
                                <input type="text" matInput [(ngModel)]="nomInput" placeholder="Last name" />
                            </mat-form-field>

                            <!-- Search Button -->
                            <button (click)="retrieveUsersForDiscussion()" mat-stroked-button>
                                üîç
                            </button>
                        </div>

                        <h3 style="margin: 0;">Community title:</h3>
                        <mat-form-field class="fuse-mat-bold w-full" style="margin-bottom: 20px;">
                            <input type="text" matInput [(ngModel)]="inputTitle"
                                placeholder="Insert community title here">
                        </mat-form-field>
                        <h3 style="margin: 0;">Insert image for Community:</h3>
                        <input type="file" (change)="handleFileInput($event)" style="margin-bottom: 10px;">
                        <div *ngIf="imageDatam !== ' ' else fallback">
                            <img [src]="imageDatam" alt="Uploaded Image"
                                style="width: 70px; height: 70px; border-radius: 50%;">
                        </div>
                        <ng-template #fallback>
                            <img [src]="'https://i.pinimg.com/originals/71/c7/53/71c7533cc831bf2d6ddffdd74cd117bb.png'"
                                alt="Default Image" style="width: 70px; height: 70px; border-radius: 50%;">
                        </ng-template>
            </div>

            <!-- Channel List -->
            <div style="flex: 1; overflow-y: auto; max-height: 300px;">
                <h3 style="margin: 0;">Channels:</h3>
                <div *ngFor="let channel of existingChannels; let i=index">
                    <mat-form-field class="fuse-mat-bold w-full">
                        <input type="text" matInput [(ngModel)]="existingChannels[i]" placeholder="Channel {{ i + 1 }}">
                    </mat-form-field>
                </div>
                <div>

                    <button (click)="addChannel()" style="margin-right: 10px;">+</button>
                    <button (click)="removeChannel()" style="margin-right: 10px;">-</button>
                </div>
            </div>

        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px;">
            <button class="bg-primary-400" mat-raised-button (click)="modifyCommunity()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px;">Confirm</button>
            <button class="bg-gray-200" mat-raised-button (click)="closeModald()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px;">Close</button>
        </div>
    </div>
</div>



<div class="modal" [ngClass]="{'hidden': !showModale}"
    style="box-shadow: -2px 0px 8px rgba(0,0,0,0.1); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
    </div>
    <div class="modal-content dark:bg-hover bg-white"
        style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; width: 26%; max-width: 800px; z-index: 10000;">
        <h2 style="margin-bottom: 20px; text-align: center;">Students of {{currentDiscussionTitle}} discussion :</h2>
        <div style="display: flex; flex-direction: row;">
            <!-- Duplicate this section to create three columns -->
            <div style="flex: 1; margin-right: 20px; overflow-y: auto; max-height: 500px;">
                <div *ngFor="let user of existingUsers" (click)="toggleUserSelection(user)"
                    [ngClass]="{'bg-primary-400': isUserSelected(user)}"
                    style="border: 1px solid lightgray; border-radius: 8px; padding: 10px; margin-bottom: 5px; display: flex; align-items: center; cursor: pointer;">


                    <div style="display: flex; align-items: center;">
                        <img src="http://localhost:9000/pidev/api/v1/auth/{{user.id}}/image"
                            style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
                            alt="{{user.prenom}} {{user.nom}}">
                        <span>{{ user.prenom }} {{ user.nom }}</span>
                    </div>

                </div>
            </div>


        </div>

        <br>

        <div class="modal-footer" style="display: flex; justify-content: flex-end;">

            <h3 style="margin: 0;">Checked students are admins : </h3>
            <button class="bg-primary-400" mat-raised-button (click)="addAdmins()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px; margin-right: 10px;">Add Admins</button>
            <button class="bg-gray-200" mat-raised-button (click)="closeModale()"
                style="border-radius: 8%; border: 4px; padding: 10px 20px;">Close</button>
        </div>
    </div>
</div>



<div class="modal" [ngClass]="{'hidden': !showModalf}"
    style="box-shadow: -2px 0px 8px rgba(0,0,0,0.1); position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div class="modal-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);"
        (click)="closeModale()">
    </div>
    <div class="modal-content dark:bg-hover bg-white"
        style="border: 1px solid #ccc; border-radius: 8px; padding: 20px; width: 100%; max-width: 800px; z-index: 10000;">
        <h2 style="margin-bottom: 20px; text-align: center;">Choose your emoji:</h2>
        
        <!-- Scrollable emoji container with fixed height -->
        <div style="display: flex; flex-direction: column; overflow-y: auto; height: 300px;">
            <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                <ng-container *ngFor="let emoji of emojis">
                    <button (click)="sendMessageo = sendMessageo + emoji" 
                            style="padding: 10px; font-size: 35px; cursor: pointer; margin: 5px;">
                        {{emoji}}
                    </button>
                </ng-container>
            </div>
        </div>

        <div class="modal-footer" style="display: flex; justify-content: flex-end; margin-top: 20px;">
            <button class="bg-gray-200" (click)="closeModalf()"
                style="border-radius: 8%; padding: 10px 20px;">Close</button>
        </div>
    </div>
</div>










<div class="fixed lg:sticky top-0 bottom-0 lg:left-full w-full sm:w-16 lg:w-16 lg:h-screen lg:shadow">
    <div class="flex flex-col w-full sm:w-120 lg:w-120 h-full transition-transform duration-400 ease-drawer bg-card"
        [ngClass]="{'-translate-x-full lg:-translate-x-100 sm:-translate-x-120  shadow': opened, 'translate-x-0': !opened}">

        <!-- Header -->
        <div class="quick-chat-header flex flex-0 items-center justify-start cursor-pointer">
            <!-- Toggle -->
            <ng-container *ngIf="!opened || (opened && !selectedChat)">
                <div class="flex flex-auto items-center justify-center">
                    <div (click)="toggle()" class="flex flex-0 items-center justify-center w-16">
                        <mat-icon class="icon-size-6" [svgIcon]="'heroicons_outline:chat-alt-2'"></mat-icon>
                    </div>

                    <div>



                        <div (click)="toggle()" class="text-lg font-medium text-secondary">
                            {{currentCommunityTitle}}{{currentDiscussionTitle}}</div>


                        <input #fileInput type="file" (change)="onFileSelected($event)" style="display: none" />

                        <!-- This button will trigger the file input click -->
                        <button class="ml-auto mr-4" mat-icon-button
                            Class="hover:bg-gray-100 dark:hover:bg-hover': showPinsB"
                            (click)="openFileDialog()" [disabled]="!currentDiscussion">
                            üìÑ
                        </button>

                        <button (click)="showPins()" [disabled]="!currentDiscussion" class="ml-auto mr-4" mat-icon-button [ngClass]="{'hover:bg-gray-100 dark:hover:bg-hover':  showPinsB,
                    'hover:bg-primary-400 bg-primary-400 dark:bg-primary-400 dark:hover:bg-primary-400': showPinsB}">
                            üìå
                        </button>

                        <button (click)="askQuestion(sendMessageo)" [disabled]="!currentDiscussion" class="ml-auto mr-4" mat-icon-button
                            [ngClass]="'hover:bg-gray-100 dark:hover:bg-hover'">
                            ‚ú®
                        </button>

                        <button [disabled]="!currentDiscussion" (click)="openModalf()"
                            class="ml-auto mr-4" mat-icon-button [ngClass]="'hover:bg-gray-100 dark:hover:bg-hover'">
                            üòÄ
                        </button>

                        <button [disabled]="currentDiscussionType == 'Duo' || !currentDiscussion" (click)="openModale()" class="ml-auto mr-4"
                            mat-icon-button [ngClass]="'hover:bg-gray-100 dark:hover:bg-hover'">
                            üë®‚Äçüë©‚Äçüëß‚Äçüë¶
                        </button>

                        <!-- Wrapper that contains the main button and the hidden buttons -->
                        <div class="relative group inline-block">

                            <!-- Main button -->
                            <button class="p-2 rounded hover:bg-gray-300" mat-icon-button>‚¨áÔ∏è</button>

                            <!-- Hidden buttons that appear on hover -->
          
                            <div
                                class="absolute left-0 top-full mt-2 opacity-0 transform -translate-y-100 transition-all duration-300 group-hover:opacity-100 group-hover:translate-y-0 flex flex-col space-y-2 z-10">


                                <button [disabled]="currentDiscussionType == 'Duo' || !currentDiscussion" (click)="leaveDiscussion()"
                                class="p-2 bg-gray-200 rounded hover:bg-gray-300">
                                üëã Leave
                            </button>

                                <!-- Settings button -->
                                <button [disabled]="currentDiscussionType == 'Duo' || !currentDiscussion" (click)="handlemodclick()"
                                    class="p-2 bg-gray-200 rounded hover:bg-gray-300">
                                    üîß Modify
                                </button>

                                <!-- Delete button -->
                                <button (click)="deleteDiscussion()" [disabled]="!currentDiscussion" style="width:115px" class="p-2 bg-gray-200 rounded hover:bg-gray-300">
                                    ‚ùå Delete
                                </button>

                                <button (click)="summarize()" [disabled]="!currentDiscussion" class="p-2 bg-gray-200 rounded hover:bg-gray-300">
                                    üí° Summarize
                                </button>

                                <button (click)="emotion()" [disabled]="!currentDiscussion" class="p-2 bg-gray-200 rounded hover:bg-gray-300">
                                    üëÄ Emotion
                                </button>

                                <button (click)="search()" [disabled]="!currentDiscussion" class="p-2 bg-gray-200 rounded hover:bg-gray-300">
                                    üîç Search
                                </button>
                            </div>

                        </div>


                    </div>

                    <button (click)="toggle()" class="ml-auto mr-4" mat-icon-button>
                        <mat-icon [svgIcon]="'heroicons_outline:x'"></mat-icon>
                    </button>

                </div>
            </ng-container>
        </div>

        <!-- Content -->
        <div class="flex flex-auto border-t overflow-hidden">

            <!-- Chat list -->
            <div class="flex-0 w-20 h-full overflow-y-auto overscroll-y-contain sm:overflow-hidden sm:overscroll-auto"
                fuseScrollbar [fuseScrollbarOptions]="{wheelPropagation: false}">
                <div class="flex-auto">


                    <div class="flex items-center py-3 px-4 cursor-pointer"
                        [ngClass]="'hover:bg-gray-100 dark:hover:bg-hover'" (click)="openModala()"
                        style="font-size: x-large;">

                        <div class="relative flex flex-0 items-center justify-center w-12">

                            ‚ûï
                        </div>




                    </div>

                    <ng-container *ngFor="let discussion of discussions">


                        <div class="flex items-center py-3 px-4 cursor-pointer"
                            [ngClass]="{'hover:bg-gray-100 dark:hover:bg-hover': currentDiscussion.id !== discussion.id,
                                        'hover:bg-primary-400 bg-primary-400 dark:bg-primary-400 dark:hover:bg-primary-400': currentDiscussion === discussion.id}"

                            (click)="selectDiscussion(discussion)">


                            <ng-container *ngIf="discussion.typeDiscussion === 'Duo'; else titleTemplate">


                                <ng-container *ngIf="currentUserId === discussion.users[0].id; else titleeTemplate">

                                    <div class="relative flex flex-0 items-center justify-center w-12 h-12">

                                        <img class="w-full h-full rounded-full object-cover"

                                            src="http://localhost:9000/pidev/api/v1/auth/{{discussion.users[1].id}}/image"
                                            alt="Contact avatar" />

                                    </div>


                                </ng-container>

                                <ng-template #titleeTemplate>
                                    <div class="relative flex flex-0 items-center justify-center w-12 h-12">

                                        <img class="w-full h-full rounded-full object-cover"

                                            src="http://localhost:9000/pidev/api/v1/auth/{{discussion.users[0].id}}/image"
                                            alt="Contact avatar" />

                                    </div>
                                </ng-template>


                            </ng-container>
                            <ng-template #titleTemplate>
                                <ng-container *ngIf="discussion.photo != ' ' else noI">

                                    <div class="relative flex flex-0 items-center justify-center w-12 h-12">

                                        <img class="w-full h-full rounded-full object-cover" src="{{discussion.photo}}"
                                            alt="Contact avatar" />

                                    </div>


                                </ng-container>

                                <ng-template #noI>
                                    {{discussion.title}}
                                </ng-template>
                            </ng-template>




                        </div>
                    </ng-container>
                </div>
            </div>

            <!-- Conversation -->
            <div class="flex-0 w-80 border-l overflow-hidden bg-gray-50 dark:bg-transparent">

                <div #chatContainer class="flex flex-col-reverse overflow-y-auto overscroll-y-contain h-full">
                    <div class="flex flex-col flex-auto shrink p-6">
                        <ng-container *ngIf="messages && messages.length > 0">

                            <ng-container *ngIf="!messages[0].message.startsWith('üèÅ Discussion started by') && searching == false && showPinsB == false">
                                <button class="bg-blue-300" mat-button
                                    (click)="retrieveMoreMessages(messages[0].discussion.id)"> Load more
                                    messages</button>
                            </ng-container>
                        </ng-container>

                        <ng-container
                            *ngFor="let message of messages; let i = index; let first = first; let last = last; trackBy: trackByFn">

                            <!-- Start of the day -->
                            <ng-container
                                *ngIf="first || (messages[i - 1]?.dateSent | date:'d') !== (message.dateSent | date:'d')">
                                <div class="flex items-center justify-center my-3 -mx-6">
                                    <div class="flex-auto border-b"></div>
                                    <div class="flex-0 mx-4 text-sm font-medium leading-5 text-secondary">
                                        {{ message.dateSent | date: 'longDate' }}
                                    </div>
                                    <div class="flex-auto border-b"></div>
                                </div>
                            </ng-container>

                            <!-- Message Container -->
                            <div class="flex flex-col" [ngClass]="{
                              'items-center': message.message.startsWith('ü§ñ'),
                              'items-end': message.user.id === currentUserId && !message.message.startsWith('ü§ñ'),
                              'items-start': message.user.id !== currentUserId && !message.message.startsWith('ü§ñ')
                            }">
                                <!-- Display user name if not 'Duo' and the message is on the left -->
                                <ng-container
                                    *ngIf="currentDiscussionType !== 'Duo' && message.user.id !== currentUserId">
                                    <div class="text-xs text-secondary mb-1">
                                        {{ message.user.prenom }} {{ message.user.nom }}
                                    </div>
                                </ng-container>

                                <ng-container *ngIf="message.reply">
                                    <ng-container *ngIf="!message.reply.archived">
                                        <div (click)="onMessageClick(message.reply)"
                                            class="relative max-w-60 px-3 py-2 rounded-lg bg-gray-300 text-gray-900"
                                            style="border-left: 3px solid gray;">
                                            <!-- Limit the display to 5 lines with ellipsis when overflowing -->
                                            <div class="min-w-4 leading-5" [innerHTML]="message.reply.message" style="
                                      display: -webkit-box;
                                      -webkit-box-orient: vertical;
                                      -webkit-line-clamp: 5;
                                      overflow: hidden;
                                      text-overflow: ellipsis;
                                      white-space: pre-wrap;
                                      word-wrap: break-word;

                                    "></div>
                                        </div>
                                        <div style="height: 5px;"></div>
                                    </ng-container>
                                </ng-container>

                                <!-- Actual Message -->
                                <div (click)="onMessageClick(message)" class="relative max-w-60 px-3 py-2 rounded-lg"
                                    [ngClass]="{
                                'bg-green-500 text-green-50': message.message.startsWith('ü§ñ'),
                                'bg-primary-500 text-primary-50': message.user.id === currentUserId && !message.message.startsWith('ü§ñ'),
                                'bg-gray-500 text-gray-50': message.user.id !== currentUserId && !message.message.startsWith('ü§ñ')
                              }">
                                    <!-- Speech bubble tail -->
                                    <div class="absolute bottom-0 w-3" [ngClass]="{
                                  'hidden': message.message.startsWith('ü§ñ'),
                                  'text-primary-500 -right-1 -mr-px mb-px': message.user.id === currentUserId && !message.message.startsWith('ü§ñ'),
                                  'text-gray-500 -left-1 -ml-px mb-px -scale-x-1': message.user.id !== currentUserId && !message.message.startsWith('ü§ñ')
                                }">
                                        <ng-container *ngTemplateOutlet="speechBubbleExtension"></ng-container>
                                    </div>

                                    <!-- Message content -->

                                    <div class="min-w-4 leading-5" style="word-wrap: break-word;">
                                        <ng-container *ngIf="message.message.endsWith('?alt=media'); else textMessage">
                                            <!-- If message is an image URL -->


                                            <ng-container *ngIf="isImage(message.message); else notImage">
                                                <img [src]="message.message" alt="Image message"
                                                    style="max-width: 100%; height: auto;" />
                                            </ng-container>


                                            <ng-template #notImage>
                                                <div class="min-w-4 leading-5" style="word-wrap: break-word;">
                                                    üìÑ {{extractTextFromURL(message.message)}}
                                                </div>
                                            </ng-template>

                                            <a [href]="message.message" style=" 
                                                font-weight: bold;
                                                text-decoration: underline;
                                                text-decoration-thickness: 1px;
                                                text-decoration-color: white;
                                                text-decoration-style:solid;" target="_blank">
                                                Open üëâ
                                            </a>
                                        </ng-container>

                                        <!-- Fallback for text message -->
                                        <ng-template #textMessage>
                                            <div class="min-w-4 leading-5" [innerHTML]="message.message"
                                                style="word-wrap: break-word;"></div>
                                        </ng-template>
                                    </div>

                                </div>

                                <!-- Reactions -->
                                <div class="flex flex-wrap mt-2 text-lg">
                                    <ng-container *ngFor="let reaction of groupReactions(message.reactions)">
                                        <div class="flex items-center mr-2">
                                            <span>{{ reaction.emoji }}</span>
                                            <span class="ml-1">{{ reaction.count }}</span>
                                        </div>
                                    </ng-container>
                                </div>

                                <!-- Timestamp -->
                                <ng-container
                                    *ngIf="first || last || (messages[i - 1]?.user.id === currentUserId) !== (message.user.id === currentUserId) || messages[i + 1]?.dateSent !== message.dateSent">
                                    <div class="my-0.5 text-sm font-medium text-secondary" [ngClass]="{
                                  'mr-3': message.user.id === currentUserId,
                                  'ml-3': message.user.id !== currentUserId
                                }">
                                        {{ message.dateSent | date:'HH:mm' }}
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>

                        <!-- Extra spacing at the end to prevent clipping -->
                        <div>&nbsp;</div>
                        <div>&nbsp;</div>
                        <div>&nbsp;</div>

                    </div>

                </div>




                <!-- Message field -->

                <div class="flex flex-auto p-4 border-t bg-gray-50 dark:bg-hover"
                    style="position: fixed; bottom: 0; width:69% ">
                    <mat-form-field class="fuse-mat-dense fuse-mat-rounded fuse-mat-bold w-full"
                        [subscriptSizing]="'dynamic'">
                        <textarea matInput cdkTextareaAutosize #messageInput placeholder="Type your message"
                            [(ngModel)]="sendMessageo" (keydown.enter)="onEnter($event)"></textarea>
                    </mat-form-field>
                    <div class="flex items-center h-11 my-px ml-4">
                        <button (click)="sendMessage()" mat-icon-button>
                            <mat-icon class="rotate-90" [svgIcon]="'heroicons_outline:paper-airplane'"></mat-icon>


                        </button>
                    </div>
                </div>

            </div>

            <!-- Chat list -->
            <div class="dark:bg-hover bg-gray-100 flex-col h-full overflow-y-auto overscroll-y-contain sm:overflow-hidden sm:overscroll-auto"
                fuseScrollbar [fuseScrollbarOptions]="{wheelPropagation: false}">
                <div class="flex-auto">


                    <div class="bg-primary-500 flex items-end py-3 px-4 cursor-pointer">
                        <div class="relative flex flex-0 items-center justify-center w-8 h-20">

                            <div class="vertical-text"
                                style="writing-mode: vertical-rl; font-weight: bold; color: white;">
                                üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Community
                            </div>


                        </div>
                    </div>

                    <div class="flex items-center py-3 px-4 cursor-pointer"
                        [ngClass]="'bg-primary-500 hover:bg-gray-100 dark:hover:bg-hover'" (click)="openModalb()"
                        style="font-size: x-large;">

                        <div class="relative flex flex-0 items-center justify-center w-8 h-5" style="color: white;">

                            <span style="color: white; font-size: 40px;">+</span>

                        </div>




                    </div>

                    <div class="flex items-center py-3 px-4 cursor-pointer" [ngClass]="{'hover:bg-gray-200 dark:hover:bg-hover': currentCommunity != 0,
                            'hover:bg-gray-400 bg-gray-400 dark:hover:bg-hover dark:bg-hover': currentCommunity == 0}"
                        (click)="selectDM()">
                        <div class="relative flex flex-0 items-center justify-center w-8 h-8">
                            <h1>üîµDMsüîµ</h1>
                        </div>
                    </div>
                    <ng-container *ngFor="let community of communities">
                        <div class="flex items-center py-3 px-4 cursor-pointer"
                            [ngClass]="{'hover:bg-gray-200 dark:hover:bg-hover': currentCommunity != community.id,
                                      'hover:bg-gray-400 bg-gray-400 dark:hover:bg-hover dark:bg-hover ': currentCommunity == community.id}"

                            (click)="selectCommunity(community.id,community.updating)">
                            <div class="relative flex flex-0 items-center justify-center w-8 h-8">
                                <ng-container *ngIf="community.photo != ' ' else noIx">

                                    <div class="relative flex flex-0 items-center justify-center w-12 h-12">

                                        <img class="w-full h-full rounded-full object-cover" src="{{community.photo}}"
                                            alt="Contact avatar" />

                                    </div>


                                </ng-container>

                                <ng-template #noIx>
                                    {{community.title}}
                                </ng-template>
                            </div>
                        </div>

                    </ng-container>



                </div>
            </div>
        </div>

    </div>
</div>

<div class="dark:bg-hover bg-white" *ngIf="currentMessage" [ngClass]="{'expanded': showEmojiList}" style="
    border-top-left-radius: 7%; 
    border-bottom-left-radius: 7%; 
    position: fixed; 
    right: 0; 
    top: 10%; 
    width: 45%; 
    border-left: 1px solid #ccc; 
    padding: 16px; 
    box-shadow: -2px 0px 8px rgba(0,0,0,0.1);">



    <div style="display: flex; align-items: center;">

        <img src="http://localhost:9000/pidev/api/v1/auth/{{currentMessage.user.id}}/image"
            style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;"
            alt="{{ currentMessage.user.prenom }} {{ currentMessage.user.nom }}">
        <span> {{ currentMessage.user.prenom }} {{ currentMessage.user.nom }}</span>
    </div>

    <br>

    <div style="
      border: 1px solid #ccc; 
      padding: 12px; 
      background: #f9f9f9; 
      overflow-y: auto; 
      max-height: 8em; 
      white-space: pre-wrap; 
      word-wrap: break-word;">
        {{ currentMessage.message }}
    </div>

    <!-- Input field and buttons for editing and replying -->
    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
        <mat-form-field style="flex: 1; margin: 0 10px;">
            <input matInput placeholder="Insert message here" [(ngModel)]="editreplyMessageo" />
        </mat-form-field>
    </div>

    <!-- Action buttons -->
    <div style="display: flex; justify-content: space-between; margin-top: 8px; flex-wrap: wrap;">
        <!-- Delete, Modify, Reply -->
        <button (click)="deleteMessage(currentMessage.id)" [ngClass]="{
        'bg-gray-500': currentMessage.user.id !== currentUserId,

        'bg-gray-500': currentMessage.message.startsWith('üèÅ Discussion started by'),
        'bg-gray-200': currentMessage.user.id === currentUserId
      }" style="padding: 8px 12px; border-radius: 50%; font-size: large;"
            [disabled]="currentMessage.user.id !== currentUserId || currentMessage.message.startsWith('üèÅ Discussion started by')">
            üóëÔ∏è
        </button>

        <button (click)="modifyMessage(currentMessage.id)" [ngClass]="{
        'bg-gray-500': currentMessage.user.id !== currentUserId,

        'bg-gray-500': currentMessage.message.startsWith('üèÅ Discussion started by'),
        'bg-gray-200': currentMessage.user.id === currentUserId
      }" style="padding: 8px 12px; border-radius: 50%; font-size: large;"
            [disabled]="currentMessage.user.id !== currentUserId || currentMessage.message.startsWith('üèÅ Discussion started by')">
            ‚úèÔ∏è
        </button>

        <button (click)="replyMessage(currentMessage.id)" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">
            üì©
        </button>

        <!-- Pin, Report, React, Share, Translate -->
        <button (click)="pinMessage()" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">
            üìå
        </button>

        <button (click)="askQuestion(currentMessage.message + ' ' + editreplyMessageo)" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">

            ‚ú®
        </button>

        <!-- Heart button for showing the emoji list -->
        <button (click)="performAction('react')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">
            üíñ
        </button>

        <button (click)="pforwarding()" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">
            üîó
        </button>

        <button (click)="performAction('translate')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">
            üåê
        </button>

        <button (click)="performAction('close')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">
            ‚ùå
        </button>
    </div>

    <!-- Emoji reaction list -->
    <div *ngIf="showFEmoji" style="
      border-top: 1px solid #ccc; 
      padding: 12px; 
      background: #f9f9f9; 
      display: flex; 
      justify-content: space-around; 
      flex-wrap: wrap;
      margin-top: 8px;
    ">
        <!-- List of additional emoji -->
        <button (click)="reactMessage(currentMessage.id,'üëç')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üëç</button>
        <button (click)="reactMessage(currentMessage.id,'üëé')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üëé</button>
        <button (click)="reactMessage(currentMessage.id,'üíñ')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üíñ</button>
        <button (click)="reactMessage(currentMessage.id,'üòä')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üòä</button>
        <button (click)="reactMessage(currentMessage.id,'üò¢')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üò¢</button>
        <button (click)="reactMessage(currentMessage.id,'üò°')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üò°</button>
        <button (click)="reactMessage(currentMessage.id,'üòÆ')" class="bg-gray-200"
            style="padding: 8px 12px; border-radius: 50%; font-size: large;">üòÆ</button>
    </div>


    <!-- Emoji reaction list -->
    <!-- Emoji reaction list with translation -->
    <div *ngIf="showFTranslate" style="
border-top: 1px solid #ccc; 
padding: 12px; 
background: #f9f9f9; 
display: flex; 
flex-direction: column; 
align-items: center; 
justify-content: center; 
margin-top: 8px;
">
        <!-- Select box for choosing languages -->
        <div style="
  width: 100%; 
  max-width: 400px; 
  text-align: center; 
  margin-bottom: 8px;
">
            <select [(ngModel)]="selectedLanguage" style="
    width: 100%; 
    padding: 10px; 
    background: #fff; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
    font-size: 1em;
  ">
                <option *ngFor="let language of languages" [value]="language">
                    {{ language }}
                </option>
            </select>
        </div>

        <!-- Translated text and translate button -->
        <div style="
  width: 100%; 
  max-width: 400px; 
  text-align: center; 
  margin-bottom: 8px;
">
            <p style="
    padding: 12px; 
    background: #e0f7fa; 
    border: 1px solid #007bff; 
    border-radius: 4px; 
    overflow-x: auto;
  ">
                {{ translated }}
            </p>
        </div>

        <button (click)="translate()" style="
  padding: 10px 20px; 
  background-color: #007bff; 
  color: white; 
  border: none; 
  border-radius: 4px; 
  cursor: pointer;
">
            Translate
        </button>
    </div>

</div>




<!-- Select chat or start new template -->
<ng-template #selectChatOrStartNew>
    <div class="flex flex-col flex-auto items-center justify-center w-full h-full p-4">
        <mat-icon class="icon-size-24" [svgIcon]="'heroicons_outline:chat'"></mat-icon>
        <div class="mt-4 text-xl text-center font-medium tracking-tight text-secondary">Select a conversation</div>
    </div>
</ng-template>

<!-- Speech bubble tail SVG -->
<ng-template #speechBubbleExtension>
    <svg width="100%" height="100%" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <path
                d="M1.01522827,0.516204834 C-8.83532715,54.3062744 61.7609863,70.5215302 64.8009949,64.3061218 C68.8074951,54.8859711 30.1663208,52.9997559 37.5036011,0.516204834 L1.01522827,0.516204834 Z"
                fill="currentColor" fill-rule="nonzero"></path>
        </g>
    </svg>
</ng-template>